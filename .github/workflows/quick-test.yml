name: Quick Test

on:
  workflow_dispatch:
    inputs:
      scrape_type:
        description: 'Type of scrape'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - incremental
      
      force:
        description: 'Force full scrape'
        required: false
        default: false
        type: boolean

jobs:
  test-scrape:
    name: Quick Test Scrape
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install -e .
      
      - name: Create directories
        run: mkdir -p data/ downloads/ logs/
      
      - name: Run scraper
        run: |
          python -m scraper full --namespace 4 --database data/irowiki.db
      
      - name: Test generate stats script
        run: |
          bash scripts/generate-stats.sh data/irowiki.db > release-notes.md
          echo "Stats generated successfully!"
          cat release-notes.md
